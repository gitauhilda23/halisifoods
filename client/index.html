<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>My Foods & Recipes - Authentic Kenyan Recipe eBooks</title>
    <meta name="description" content="Discover authentic Kenyan recipe eBooks featuring traditional dishes like ugali, nyama choma, and sukuma wiki. Instant digital downloads with detailed ingredients and cooking instructions." />
    <meta property="og:title" content="My Foods & Recipes - Authentic Kenyan Recipe eBooks" />
    <meta property="og:description" content="Discover authentic Kenyan recipe eBooks with instant digital downloads. Traditional dishes, modern cuisine, and everything in between." />
    <meta property="og:type" content="website" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
   
    <!-- PAYSTACK SCRIPT -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- SINGLE PURCHASE (KEEPS WORKING) -->
    <script>
      window.payWithPaystack = function({ email, phone, amount, recipeId, recipeName, onSuccess, onClose }) {
        const handler = PaystackPop.setup({
          key: 'pk_live_b1bc14d3250387de5175b9ebb291d9101904c741',
          email: email,
          amount: amount * 100,
          currency: 'KES',
          ref: 'MFR_' + Date.now() + '_' + Math.floor(Math.random() * 1000000000),
          metadata: { recipeId, recipeName, phone },
          callback: function(response) {
            fetch('/api/verify-payment', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                reference: response.reference,
                recipeId: recipeId,
                email: email,
                phone: phone
              })
            })
            .then(r => r.json())
            .then(data => {
              if (data.success && data.downloadUrl && onSuccess) {
                onSuccess(data.downloadUrl);
              } else {
                alert('Payment failed. Contact support@myfoodsandrecipes.com');
              }
            })
            .catch(() => alert('Network error. Try again.'));
          },
          onClose: () => onClose?.() || alert('Payment cancelled.')
        });
        handler.openIframe();
      };
    </script>

    <!-- CART PURCHASE â€” BUY MULTIPLE AT ONCE (NEW!) -->
    <script>
      window.payWithPaystackCart = function({ email, phone, items, onSuccess, onClose }) {
        // Calculate total + discount
        const baseTotal = items.reduce((sum, i) => sum + i.amount, 0);
        const discount = items.length >= 3 ? 400 : items.length >= 2 ? 100 : 0;
        const finalAmount = baseTotal - discount;

        const handler = PaystackPop.setup({
          key: 'pk_live_b1bc14d3250387de5175b9ebb291d9101904c741',
          email: email,
          amount: finalAmount * 100,
          currency: 'KES',
          ref: 'MFR_CART_' + Date.now() + '_' + Math.floor(Math.random() * 1000000000),
          metadata: { 
            phone,
            cart_size: items.length,
            discount: discount,
            items: items.map(i => ({ id: i.recipeId, name: i.recipeName, price: i.amount }))
          },
          callback: function(response) {
            fetch('/api/verify-payment-cart', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                reference: response.reference,
                email: email,
                phone: phone,
                items: items
              })
            })
            .then(r => r.json())
            .then(data => {
              if (data.success && data.downloadUrls) {
                onSuccess(data.downloadUrls, finalAmount, discount);
              } else {
                alert('Payment failed. Contact support@myfoodsandrecipes.com');
              }
            })
            .catch(() => alert('Network error. Try again.'));
          },
          onClose: () => onClose?.() || alert('Payment cancelled.')
        });
        handler.openIframe();
      };
    </script>
  </body>
</html>
